<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>שאלון משוב - סיורים תעשייתיים</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Assistant', sans-serif; background-color: #f7fafc; }
        .form-section { background-color: #ffffff; border: 1px solid #e2e8f0; padding: 20px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1); }
        .section-title { font-size: 1.5rem; font-weight: 700; color: #1e3a8a; border-bottom: 2px solid #3b82f6; padding-bottom: 8px; margin-bottom: 20px; }
        label, .label-title { font-weight: 600; display: block; margin-bottom: 10px; color: #1e293b; }
        .options { margin-top: 5px; }
        .required-star { color: #ef4444; }
        .form-input, .form-textarea, .form-select { border-color: #cbd5e1; border-radius: 8px; width: 100%; padding: 8px; transition: border-color 0.2s, box-shadow 0.2s; }
        .form-input:focus, .form-textarea:focus, .form-select:focus { border-color: #3b82f6; box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.25); outline: none; }
        .btn { padding: 12px 24px; border-radius: 8px; transition: background-color 0.3s; font-weight: bold; border: none; cursor: pointer; }
        .btn-primary { background-color: #2563eb; color: white; width: 100%; }
        .btn-primary:hover { background-color: #1d4ed8; }
        .btn-secondary { background-color: #64748b; color: white; }
        .btn-secondary:hover { background-color: #475569; }
        .rating-group input:checked + div { background-color: #2563eb; color: white; border-color: #1d4ed8; }
    </style>
</head>
<body class="text-gray-800">

    <div id="app-container" class="container mx-auto p-4 md:p-8 max-w-3xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-900">שאלון משוב ומיפוי צרכים</h1>
            <p class="text-lg text-gray-600 mt-2">המשוב שלך יעזור לנו לעצב את הסיורים הבאים.</p>
        </header>

        <form id="surveyForm" novalidate>
            <!-- Part A: General Details -->
            <div id="part-a" class="form-section">
                <h2 class="section-title">חלק א': פרטים כלליים</h2>
                
                <div class="mb-4">
                    <label for="study_year">1. שנת לימודים <span class="required-star">*</span></label>
                    <select id="study_year" name="study_year" class="form-select" required>
                        <option value="" disabled selected>נא לבחור...</option>
                        <option value="שנה א'">שנה א'</option>
                        <option value="שנה ב'">שנה ב'</option>
                        <option value="שנה ג'">שנה ג'</option>
                        <option value="שנה ד'">שנה ד'</option>
                    </select>
                </div>
                <div class="mb-4 hidden" id="specialization-block">
                    <label for="specialization">2. מסלול התמחות <span class="required-star">*</span></label>
                    <select id="specialization" name="specialization" class="form-select">
                        <option value="" disabled selected>נא לבחור...</option>
                        <option value="חומרים מבניים">חומרים מבניים</option>
                        <option value="חומרים אלקטרוניים">חומרים אלקטרוניים</option>
                        <option value="אחר">אחר</option>
                    </select>
                </div>
                <div class="mb-4"><label for="age">3. גיל <span class="required-star">*</span></label><input type="number" id="age" name="age" class="form-input" required></div>
                <fieldset class="mb-4">
                    <legend class="label-title">4. מגדר <span class="required-star">*</span></legend>
                    <div class="options space-y-2">
                        <label for="gender_male" class="font-normal flex items-center"><input type="radio" id="gender_male" name="gender" value="זכר" class="ml-2" required> זכר</label>
                        <label for="gender_female" class="font-normal flex items-center"><input type="radio" id="gender_female" name="gender" value="נקבה" class="ml-2" required> נקבה</label>
                        <label for="gender_other" class="font-normal flex items-center"><input type="radio" id="gender_other" name="gender" value="אחר" class="ml-2" required> אחר</label>
                    </div>
                </fieldset>
                <div class="mb-4"><label for="region">5. אזור מגורים עיקרי <span class="required-star">*</span></label><select id="region" name="region" class="form-select" required><option value="" disabled selected>נא לבחור...</option><option value="צפון">אזור הצפון</option><option value="שרון">אזור השרון וחוף הכרמל</option><option value="גוש דן">גוש דן</option><option value="ירושלים">אזור ירושלים והרי יהודה</option><option value="שפלה">שפלת יהודה ומישור החוף הדרומי</option><option value="דרום">הנגב והערבה</option></select></div>
                <fieldset class="mb-4">
                    <legend class="label-title">6. האם יצאת לסיור התעשייתי האחרון? <span class="required-star">*</span></legend>
                    <div class="options space-y-2">
                        <label for="attended_yes" class="font-normal flex items-center"><input type="radio" id="attended_yes" name="attended_tour" value="yes" class="ml-2" required> כן</label>
                        <label for="attended_no" class="font-normal flex items-center"><input type="radio" id="attended_no" name="attended_tour" value="no" class="ml-2" required> לא</label>
                    </div>
                </fieldset>
                <p class="text-xs text-gray-500 mt-4">המידע נאסף באופן אנונימי ומשמש למטרות סטטיסטיות ולשיפור הסיורים העתידיים בלבד.</p>
                <button type="button" id="continue-btn" class="btn btn-primary mt-6">המשך</button>
            </div>

            <!-- Part B: For Attendees -->
            <div id="part-b" class="form-section hidden">
                 <h2 class="section-title">חלק ב': משוב למשתתפי הסיור</h2>
                 <fieldset class="mb-4"><legend class="label-title">1. לאיזה סיור התפצלת? <span class="required-star">*</span></legend><div class="options space-y-2"><label for="comp_hp" class="font-normal flex items-center"><input type="radio" id="comp_hp" name="attended_company" value="HP" class="ml-2"> HP רחובות</label><label for="comp_bsem" class="font-normal flex items-center"><input type="radio" id="comp_bsem" name="attended_company" value="מנועי בית שמש" class="ml-2"> מנועי בית שמש</label><label for="comp_medex" class="font-normal flex items-center"><input type="radio" id="comp_medex" name="attended_company" value="Medex" class="ml-2"> Medex</label><label for="comp_elop" class="font-normal flex items-center"><input type="radio" id="comp_elop" name="attended_company" value="אל אופ" class="ml-2"> אל אופ</label></div></fieldset>
                
                 <fieldset class="mb-4">
                    <legend class="label-title">2. בסולם 1-10, עד כמה היית ממליץ/ה לחברים להצטרף? <span class="required-star">*</span></legend>
                    <div class="flex flex-wrap justify-center gap-2 rating-group">
                        <script>for(let i=1; i<=10; i++) document.write(`<label class="w-10"><input type="radio" name="b_recommend" value="${i}" class="sr-only" required><div class="w-full text-center p-2 border rounded-md cursor-pointer hover:bg-gray-100">${i}</div></label>`);</script>
                    </div>
                 </fieldset>

                 <fieldset class="mb-4">
                    <legend class="label-title">3. עד כמה הסיור תרם לחיבור בין תאוריה למעשה? <span class="required-star">*</span></legend>
                    <div class="flex justify-between items-center mt-2 space-x-2 space-x-reverse rating-group">
                        <script>for(let i=1; i<=5; i++) document.write(`<label class="flex-1"><input type="radio" name="b_contribution" value="${i}" class="sr-only" required><div class="w-full text-center p-2 border rounded-md cursor-pointer hover:bg-gray-100">${i}</div></label>`);</script>
                    </div>
                    <div class="flex justify-between text-xs text-gray-500 mt-1 px-1"><span>בכלל לא</span><span>במידה רבה מאוד</span></div>
                 </fieldset>

                 <fieldset class="mb-4">
                    <legend class="label-title">4. באיזו מידה הסיור חיזק את המוטיבציה ללימודים? <span class="required-star">*</span></legend>
                     <div class="flex justify-between items-center mt-2 space-x-2 space-x-reverse rating-group">
                        <script>for(let i=1; i<=5; i++) document.write(`<label class="flex-1"><input type="radio" name="b_motivation_boost" value="${i}" class="sr-only" required><div class="w-full text-center p-2 border rounded-md cursor-pointer hover:bg-gray-100">${i}</div></label>`);</script>
                    </div>
                 </fieldset>

                 <fieldset class="mb-4">
                    <legend class="label-title">5. עד כמה הסיור תרם להכוונת קריירה? <span class="required-star">*</span></legend>
                    <div class="flex justify-between items-center mt-2 space-x-2 space-x-reverse rating-group">
                        <script>for(let i=1; i<=5; i++) document.write(`<label class="flex-1"><input type="radio" name="b_career_contribution" value="${i}" class="sr-only" required><div class="w-full text-center p-2 border rounded-md cursor-pointer hover:bg-gray-100">${i}</div></label>`);</script>
                    </div>
                 </fieldset>

                 <fieldset class="mb-4">
                    <legend class="label-title">6. עד כמה סיורים צריכים להיות חלק קבוע מהתואר? <span class="required-star">*</span></legend>
                    <div class="flex justify-between items-center mt-2 space-x-2 space-x-reverse rating-group">
                        <script>for(let i=1; i<=5; i++) document.write(`<label class="flex-1"><input type="radio" name="b_should_be_part" value="${i}" class="sr-only" required><div class="w-full text-center p-2 border rounded-md cursor-pointer hover:bg-gray-100">${i}</div></label>`);</script>
                    </div>
                     <div class="flex justify-between text-xs text-gray-500 mt-1 px-1"><span>מיותר</span><span>הכרחי</span></div>
                 </fieldset>

                 <fieldset class="mb-4"><legend class="label-title">7. תדירות מומלצת לסיורים? <span class="required-star">*</span></legend><div class="options space-y-2"><label for="freq_sem" class="font-normal flex items-center"><input type="radio" id="freq_sem" name="b_frequency" value="סמסטר" class="ml-2" required> פעם בסמסטר</label><label for="freq_year" class="font-normal flex items-center"><input type="radio" id="freq_year" name="b_frequency" value="שנה" class="ml-2" required> פעם בשנה</label></div></fieldset>
                 <div class="mb-4"><label for="b_takeaway">8. מה הדבר המשמעותי ביותר שלמדת?</label><textarea id="b_takeaway" name="b_takeaway" rows="3" class="form-textarea"></textarea></div>
                 <fieldset class="mb-4"><legend class="label-title">9. תחומי עניין לסיורים הבאים:</legend><div class="options grid grid-cols-1 md:grid-cols-2 gap-2"><label for="b_int_semi" class="font-normal flex items-center"><input type="checkbox" id="b_int_semi" name="b_interests" value="מוליכים למחצה" class="ml-2"> מוליכים למחצה</label><label for="b_int_aero" class="font-normal flex items-center"><input type="checkbox" id="b_int_aero" name="b_interests" value="תעופה וביטחון" class="ml-2"> תעופה וביטחון</label><label for="b_int_med" class="font-normal flex items-center"><input type="checkbox" id="b_int_med" name="b_interests" value="מכשור רפואי" class="ml-2"> מכשור רפואי</label><label for="b_int_clean" class="font-normal flex items-center"><input type="checkbox" id="b_int_clean" name="b_interests" value="קלינטק" class="ml-2"> אנרגיה וקלינטק</label></div></fieldset>
                 <div class="mb-4"><label for="b_comments">10. הערות נוספות?</label><textarea id="b_comments" name="b_comments" rows="3" class="form-textarea"></textarea></div>
                 <button type="submit" class="btn btn-primary mt-6">שלח משוב</button>
            </div>

            <!-- Part C: For Non-Attendees -->
            <div id="part-c" class="form-section hidden">
                <h2 class="section-title">חלק ג': משוב למי שלא השתתף/ה</h2>
                <fieldset class="mb-4"><legend class="label-title">1. סיבות לאי-הגעה:</legend><div class="options space-y-2"><label for="c_reason_interest" class="font-normal flex items-center"><input type="checkbox" id="c_reason_interest" name="c_reasons" value="יעדים לא עניינו" class="ml-2"> יעדי הסיור לא עניינו אותי</label><label for="c_reason_conflict" class="font-normal flex items-center"><input type="checkbox" id="c_reason_conflict" name="c_reasons" value="חפיפה עם לימודים" class="ml-2"> חפיפה עם הרצאות</label><label for="c_reason_workload" class="font-normal flex items-center"><input type="checkbox" id="c_reason_workload" name="c_reasons" value="עומס לימודים" class="ml-2"> עומס לימודים</label></div></fieldset>
                <div class="mb-4"><label for="c_motivation">2. מה היה גורם לך כן להצטרף?</label><textarea id="c_motivation" name="c_motivation" rows="3" class="form-textarea"></textarea></div>
                <fieldset class="mb-4"><legend class="label-title">3. תחומי עניין לסיורים הבאים:</legend><div class="options grid grid-cols-1 md:grid-cols-2 gap-2"><label for="c_int_semi" class="font-normal flex items-center"><input type="checkbox" id="c_int_semi" name="c_interests" value="מוליכים למחצה" class="ml-2"> מוליכים למחצה</label><label for="c_int_aero" class="font-normal flex items-center"><input type="checkbox" id="c_int_aero" name="c_interests" value="תעופה וביטחון" class="ml-2"> תעופה וביטחון</label><label for="c_int_med" class="font-normal flex items-center"><input type="checkbox" id="c_int_med" name="c_interests" value="מכשור רפואי" class="ml-2"> מכשור רפואי</label><label for="c_int_clean" class="font-normal flex items-center"><input type="checkbox" id="c_int_clean" name="c_interests" value="קלינטק" class="ml-2"> אנרגיה וקלינטק</label></div></fieldset>
                <button type="submit" class="btn btn-primary mt-6">שלח משוב</button>
            </div>
        </form>
        
        <!-- Result Modal -->
        <div id="thank-you-container" class="hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center z-50 p-4" role="dialog" aria-modal="true" aria-labelledby="thank-you-title">
             <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 text-center max-w-lg w-full" tabindex="-1">
                <h2 id="thank-you-title" class="text-2xl md:text-3xl font-bold text-slate-800 mb-4">תודה רבה!</h2>
                <p class="text-lg text-slate-600">המשוב שלך נשלח בהצלחה ועוזר לנו מאוד בתכנון הסיורים הבאים.</p>
                <button id="reset-btn" class="btn btn-secondary mt-8">חזרה לשאלון</button>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('surveyForm');
        const partA = document.getElementById('part-a');
        const partB = document.getElementById('part-b');
        const partC = document.getElementById('part-c');
        const continueBtn = document.getElementById('continue-btn');
        const studyYearSelect = document.getElementById('study_year');
        const specializationBlock = document.getElementById('specialization-block');
        const specializationSelect = document.getElementById('specialization');
        
        const thankYouContainer = document.getElementById('thank-you-container');
        const resetBtn = document.getElementById('reset-btn');

        // This is the URL for your Google Sheet Web App. Replace it with your actual URL.
        const GOOGLE_SHEET_URL = 'https://script.google.com/macros/s/AKfycby-_cfsoJTbcLDuM_J1RN0jAEjdWsDY6bfFiXhxmb1bTlAy8T4ABtC-oMP_lVCAVljW-Q/exec';

        studyYearSelect.addEventListener('change', (event) => {
            const selectedYear = event.target.value;
            if (selectedYear === "שנה ג'" || selectedYear === "שנה ד'") {
                specializationBlock.classList.remove('hidden');
                specializationSelect.required = true;
            } else {
                specializationBlock.classList.add('hidden');
                specializationSelect.required = false;
                specializationSelect.value = ""; // Reset value if hidden
            }
        });

        function setSectionRequired(section, isRequired) {
            section.querySelectorAll('input[type="radio"], input[type="range"], select, textarea').forEach(input => {
                if(input.name){
                    input.required = isRequired;
                }
            });
             section.querySelectorAll('.rating-group').forEach(group => {
                const firstRadio = group.querySelector('input[type="radio"]');
                if (firstRadio) {
                    firstRadio.required = isRequired;
                }
            });
        }
        
        continueBtn.addEventListener('click', () => {
            const partAInputs = Array.from(partA.querySelectorAll('input[required], select[required]'));
            let allValid = true;
            for (const input of partAInputs) {
                if (!input.reportValidity()) {
                    allValid = false;
                    break;
                }
            }

            if (allValid) {
                partA.classList.add('hidden');
                const attended = form.elements['attended_tour'].value;
                if (attended === 'yes') {
                    partB.classList.remove('hidden');
                    setSectionRequired(partB, true);
                } else if (attended === 'no') {
                    partC.classList.remove('hidden');
                    setSectionRequired(partC, true);
                }
            }
        });

        async function saveData(formData) {
            if (!GOOGLE_SHEET_URL || GOOGLE_SHEET_URL.includes('הדבק כאן')) {
                console.warn('Google Sheet URL is not configured. Data will not be saved.');
                return;
            }
             // Create a flat object from FormData
            const dataToSend = {};
            for (const [key, value] of formData.entries()) {
                if (dataToSend[key]) {
                    if (!Array.isArray(dataToSend[key])) {
                        dataToSend[key] = [dataToSend[key]];
                    }
                    dataToSend[key].push(value);
                } else {
                    dataToSend[key] = value;
                }
            }
             // Join array values for sheets
            for (const key in dataToSend) {
                if (Array.isArray(dataToSend[key])) {
                    dataToSend[key] = dataToSend[key].join(', ');
                }
            }
            
            try {
                await fetch(GOOGLE_SHEET_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json', },
                    body: JSON.stringify(dataToSend)
                });
            } catch (error) {
                console.error('Error saving data to Google Sheet:', error);
            }
        }
        
        form.addEventListener('submit', async (event) => {
            event.preventDefault();
            
            const formData = new FormData(form);
            
            await saveData(formData);

            thankYouContainer.classList.remove('hidden');
            thankYouContainer.querySelector('[role="dialog"]').focus();
        });


        resetBtn.addEventListener('click', () => {
            form.reset();
            partA.classList.remove('hidden');
            partB.classList.add('hidden');
            partC.classList.add('hidden');
            specializationBlock.classList.add('hidden');
            setSectionRequired(partB, false);
            setSectionRequired(partC, false);
            specializationSelect.required = false;
            thankYouContainer.classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
            studyYearSelect.focus();
        });
    </script>
</body>
</html>
